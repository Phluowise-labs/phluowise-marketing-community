<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-5G6C5PLV");
    </script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Phluowise Marketing Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #000000;
        color: #e5e7eb;
        transition: background-color 0.3s ease;
      }

      /* The glassmorphism effect */
      .glass {
        background-color: rgba(255, 255, 255, 0.05);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
      }

      .btn-primary {
        background-color: #3b74ff;
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        transition: background-color 0.3s;
        border: none;
        cursor: pointer;
      }

      .btn-primary:hover {
        background-color: #2e5cdb;
      }

      .form-input {
        width: 100%;
        padding: 0.75rem;
        border: 1px solid #374151;
        border-radius: 0.75rem;
        background-color: #1a1a1a;
        color: #e5e7eb;
      }

      .form-input:focus {
        outline: none;
        box-shadow: 0 0 0 2px #3b74ff;
      }

      .btn-primary:focus {
        outline: none;
        box-shadow: 0 0 0 2px #3b74ff;
      }

      /* Dashboard card styles */
      .dashboard-card {
        background-color: rgba(255, 255, 255, 0.05);
        -webkit-backdrop-filter: blur(10px);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 2rem;
        padding: 2.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
      }

      /* Text colors */
      .text-gray-600 {
        color: #d1d5db;
      }

      .text-gray-500 {
        color: #9ca3af;
      }

      .text-gray-400 {
        color: #9ca3af;
      }

      .text-gray-900 {
        color: #f9fafb;
      }

      .text-gray-800 {
        color: #f3f4f6;
      }

      .text-green-600 {
        color: #4ade80;
      }

      .text-yellow-600 {
        color: #fbbf24;
      }

      /* Background colors */
      .bg-gray-900 {
        background-color: #111827;
      }

      .bg-gray-800 {
        background-color: #1f2937;
      }

      .bg-gray-700 {
        background-color: #374151;
      }

      .bg-green-100 {
        background-color: #14532d;
        color: #86efac;
      }

      .bg-yellow-100 {
        background-color: #78350f;
        color: #fde68a;
      }

      /* Borders */
      .border-gray-700 {
        border-color: #374151;
      }

      .divide-gray-700 {
        border-color: #374151;
      }

      /* Hover states */
      .hover\:bg-gray-800:hover {
        background-color: #1f2937;
      }

      .hover\:text-blue-500:hover {
        color: #3b82f6;
      }

      /* Referral Program Specific Styles */
      .referral-gradient-bg {
        background: linear-gradient(135deg, #3b74ff 0%, #2e5cdb 100%);
      }

      .status-badge {
        padding: 0.35rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .status-pending {
        background-color: rgba(245, 158, 11, 0.2);
        color: #f59e0b;
      }

      .status-approved {
        background-color: rgba(16, 185, 129, 0.2);
        color: #10b981;
      }

      .status-paid {
        background-color: rgba(139, 92, 246, 0.2);
        color: #8b5cf6;
      }

      .referral-table {
        border-collapse: separate;
        border-spacing: 0;
      }

      .referral-table th {
        background: rgba(30, 41, 59, 0.9);
      }

      .referral-table tr:last-child td {
        border-bottom: 0;
      }
    </style>
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-5G6C5PLV"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe
    ></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <!-- Sidebar Navigation -->
    <div
      id="sidebar-nav"
      class="sidebar fixed top-0 left-0 h-full w-64 bg-gray-900 border-r border-gray-700 p-6 flex-col items-start space-y-8 z-50 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out"
    >
      <div class="flex items-center justify-between w-full">
        <span class="text-2xl font-bold text-[#3b74ff]">Phluowise</span>
        <button
          id="desktopMenuToggle"
          class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
          aria-label="Toggle navigation menu"
          aria-expanded="false"
          aria-controls="sidebar-nav"
        >
          <svg
            class="w-6 h-6 text-gray-800 dark:text-gray-200"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16m-7 6h7"
            ></path>
          </svg>
        </button>
      </div>
      <div class="flex flex-col space-y-4 w-full">
        <!-- Dashboard -->
        <a
          href="index.html"
          class="flex items-center space-x-3 text-lg text-[#3b74ff] font-medium p-2 rounded-lg bg-gray-800 transition-colors"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
            ></path>
          </svg>
          <span>Dashboard</span>
        </a>

        <!-- Referral Program -->
        <a
          href="referral.html"
          id="referralNavLink"
          class="flex items-center space-x-3 text-lg text-gray-200 hover:text-[#3b74ff] font-medium p-2 rounded-lg hover:bg-gray-700 transition-colors"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"
            ></path>
          </svg>
          <span>Referral Program</span>
        </a>

        <!-- Transactions -->
        <a
          href="transactions.html"
          class="flex items-center space-x-3 text-lg text-gray-200 hover:text-[#3b74ff] font-medium p-2 rounded-lg hover:bg-gray-700 transition-colors"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            ></path>
          </svg>
          <span>Transactions</span>
        </a>

        <!-- Leaderboard -->
        <a
          href="leaderboard.html"
          class="flex items-center space-x-3 text-lg text-gray-200 hover:text-[#3b74ff] font-medium p-2 rounded-lg hover:bg-gray-700 transition-colors"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
            ></path>
          </svg>
          <span>Leaderboard</span>
        </a>

        <!-- Profile -->
        <a
          href="profile.html"
          class="flex items-center space-x-3 text-lg text-gray-200 hover:text-[#3b74ff] font-medium p-2 rounded-lg hover:bg-gray-700 transition-colors"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
            ></path>
          </svg>
          <span>Profile</span>
        </a>

        <!-- Documentation -->
        <a
          href="documentation.html"
          id="docsLink"
          class="flex items-center space-x-3 text-lg text-gray-200 hover:text-[#3b74ff] font-medium p-2 rounded-lg hover:bg-gray-700 transition-colors"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
            ></path>
          </svg>
          <span>Documentation</span>
        </a>

        <!-- Sign Out -->
        <button
          id="signOutBtn"
          class="flex items-center space-x-3 text-lg text-red-400 hover:text-red-300 font-medium p-2 rounded-lg hover:bg-red-900/20 transition-colors w-full text-left mt-8"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
            ></path>
          </svg>
          <span>Sign Out</span>
        </button>
      </div>
    </div>

    <!-- Main Dashboard Container -->
    <main
      id="main-content"
      class="ml-0 md:ml-64 p-4 md:p-8 transition-all duration-300 ease-in-out"
    >
      <!-- Mobile Menu Button -->
      <div class="flex items-center justify-between md:hidden mb-4">
        <h1 class="text-xl font-bold text-[#3b74ff]">Phluowise</h1>
        <button
          id="mobileMenuToggle"
          class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
          aria-label="Toggle navigation menu"
          aria-expanded="false"
          aria-controls="sidebar-nav"
        >
          <svg
            class="w-6 h-6 text-gray-800 dark:text-gray-200"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16m-7 6h7"
            ></path>
          </svg>
        </button>
      </div>

      <!-- Dashboard View -->
      <div id="dashboard-view">
        <!-- Main content grid with gap for margin -->
        <div class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-8">
          <!-- User and Referral Section -->
          <div class="md:col-span-1">
            <!-- Welcome Card -->
            <div class="dashboard-card glass">
              <h2 class="text-2xl font-bold mb-2">
                Welcome, <span id="userName">User</span>
              </h2>
              <p class="text-gray-400 mb-4">
                Track your referrals and earnings
              </p>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-gray-800 p-4 rounded-lg">
                  <p class="text-gray-400 text-sm">Total Referrals</p>
                  <p
                    class="text-2xl font-bold text-blue-400"
                    id="totalReferrals"
                  >
                    0
                  </p>
                </div>
                <div class="bg-gray-800 p-4 rounded-lg">
                  <p class="text-gray-400 text-sm">Active Referrals</p>
                  <p
                    class="text-2xl font-bold text-green-400"
                    id="activeReferrals"
                  >
                    0
                  </p>
                </div>
                <div class="bg-gray-800 p-4 rounded-lg">
                  <p class="text-gray-400 text-sm">Your Rank</p>
                  <p class="text-2xl font-bold text-yellow-400" id="userRank">
                    #0
                  </p>
                </div>
              </div>
            </div>

            <!-- Team Management Section (Leader Only) -->
            <div id="teamManagementSection" class="dashboard-card glass hidden">
              <h2 class="text-2xl font-bold mb-4">Team Management</h2>
              <p class="text-gray-600 dark:text-gray-300 mb-4">
                Team ID:
                <span
                  id="teamIdDisplay"
                  class="font-mono text-sm break-all"
                ></span>
              </p>

              <div class="mb-6">
                <h3 class="font-semibold text-lg mb-2">Add Team Member</h3>
                <div class="flex space-x-2">
                  <input
                    type="email"
                    id="newMemberEmail"
                    placeholder="Enter member's email"
                    class="form-input dark:bg-gray-800 dark:text-white dark:border-gray-600"
                  />
                  <button id="addMemberBtn" class="btn-primary flex-shrink-0">
                    Add
                  </button>
                </div>
              </div>

              <div>
                <h3 class="font-semibold text-lg mb-2">
                  Team Members (<span id="memberCount">0</span>/5)
                </h3>
                <ul id="memberList" class="space-y-2"></ul>
              </div>
            </div>
          </div>

          <!-- Referrals and Payments Section -->
          <div class="md:col-span-2 flex flex-col gap-8">
            <!-- Referrals List -->
            <div class="dashboard-card glass">
              <h2 class="text-2xl font-bold mb-4">Your Referrals</h2>
              <div class="overflow-x-auto">
                <table
                  class="min-w-full divide-y divide-gray-200 dark:divide-gray-700"
                >
                  <thead>
                    <tr
                      class="text-left text-xs font-semibold uppercase tracking-wider text-gray-500 dark:text-gray-400"
                    >
                      <th class="py-3 px-4">Company</th>
                      <th class="py-3 px-4">Location</th>
                      <th class="py-3 px-4">Amount</th>
                      <th class="py-3 px-4">Date</th>
                    </tr>
                  </thead>
                  <tbody
                    id="referralTableBody"
                    class="divide-y divide-gray-200 dark:divide-gray-700"
                  >
                    <!-- Referral data will be populated here -->
                  </tbody>
                </table>
                <p
                  id="noReferralsMessage"
                  class="text-center text-gray-500 dark:text-gray-400 mt-4"
                >
                  No referrals yet.
                </p>
              </div>
            </div>

            <!-- Earnings Card -->
            <div class="dashboard-card glass">
              <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Your Earnings</h2>
                <span class="text-green-400 font-semibold"
                  >+12.5% from last month</span
                >
              </div>
              <div class="h-48 bg-gray-800 rounded-lg p-4 mb-4">
                <canvas id="earningsChart"></canvas>
              </div>
              <div class="grid grid-cols-3 gap-4 mt-4">
                <div class="text-center">
                  <p class="text-gray-400 text-sm">This Month</p>
                  <p class="text-lg font-semibold text-green-400">$2,450</p>
                </div>
                <div class="text-center">
                  <p class="text-gray-400 text-sm">Last Month</p>
                  <p class="text-lg font-semibold">$2,180</p>
                </div>
                <div class="text-center">
                  <p class="text-gray-400 text-sm">Total</p>
                  <p class="text-lg font-semibold text-blue-400">$18,750</p>
                </div>
              </div>
            </div>

            <!-- Team Leaderboard -->
            <div class="dashboard-card glass">
              <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Team Leaderboard</h2>
                <span class="text-sm text-blue-400">Updated 5 min ago</span>
              </div>
              <div class="space-y-3">
                <!-- 1st Place -->
                <div
                  class="flex items-center justify-between p-3 bg-gradient-to-r from-yellow-800/30 to-yellow-900/10 rounded-lg border border-yellow-500/30"
                >
                  <div class="flex items-center space-x-3">
                    <div
                      class="w-8 h-8 rounded-full bg-yellow-500 flex items-center justify-center text-yellow-100 font-bold"
                    >
                      1
                    </div>
                    <div>
                      <p class="font-medium">Aqua Warriors</p>
                      <p class="text-sm text-yellow-300">24,500 pts</p>
                    </div>
                  </div>
                  <div class="text-right">
                    <span class="text-yellow-400 font-bold text-lg">#1</span>
                    <p class="text-xs text-yellow-400">+1,250 this week</p>
                  </div>
                </div>

                <!-- 2nd Place -->
                <div
                  class="flex items-center justify-between p-3 bg-gradient-to-r from-gray-800/30 to-gray-900/10 rounded-lg border border-gray-600/30"
                >
                  <div class="flex items-center space-x-3">
                    <div
                      class="w-8 h-8 rounded-full bg-gray-500 flex items-center justify-center text-gray-100 font-bold"
                    >
                      2
                    </div>
                    <div>
                      <p class="font-medium">Water Masters</p>
                      <p class="text-sm text-gray-400">22,150 pts</p>
                    </div>
                  </div>
                  <div class="text-right">
                    <span class="text-gray-400 font-bold text-lg">#2</span>
                    <p class="text-xs text-gray-400">+980 this week</p>
                  </div>
                </div>

                <!-- 3rd Place -->
                <div
                  class="flex items-center justify-between p-3 bg-gradient-to-r from-amber-800/30 to-amber-900/10 rounded-lg border border-amber-500/30"
                >
                  <div class="flex items-center space-x-3">
                    <div
                      class="w-8 h-8 rounded-full bg-amber-600 flex items-center justify-center text-amber-100 font-bold"
                    >
                      3
                    </div>
                    <div>
                      <p class="font-medium">Hydro Kings</p>
                      <p class="text-sm text-amber-300">20,890 pts</p>
                    </div>
                  </div>
                  <div class="text-right">
                    <span class="text-amber-400 font-bold text-lg">#3</span>
                    <p class="text-xs text-amber-400">+1,120 this week</p>
                  </div>
                </div>

                <!-- 4th Place (Your Team) -->
                <div
                  class="flex items-center justify-between p-3 bg-gradient-to-r from-blue-900/30 to-blue-900/10 rounded-lg border border-blue-500/30"
                >
                  <div class="flex items-center space-x-3">
                    <div
                      class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-blue-100 font-bold"
                    >
                      4
                    </div>
                    <div>
                      <p class="font-medium">Your Team</p>
                      <p class="text-sm text-blue-300">18,750 pts</p>
                    </div>
                  </div>
                  <div class="text-right">
                    <span class="text-blue-400 font-bold text-lg">#4</span>
                    <p class="text-xs text-blue-400">+1,450 this week</p>
                  </div>
                </div>

                <!-- 5th Place -->
                <div
                  class="flex items-center justify-between p-3 bg-gray-800/30 rounded-lg hover:bg-gray-700/30 transition-colors"
                >
                  <div class="flex items-center space-x-3">
                    <div
                      class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center text-gray-300 font-bold"
                    >
                      5
                    </div>
                    <div>
                      <p class="font-medium">Oceanic Elite</p>
                      <p class="text-sm text-gray-400">17,200 pts</p>
                    </div>
                  </div>
                  <div class="text-right">
                    <span class="text-gray-400 font-bold">#5</span>
                    <p class="text-xs text-gray-500">+890 this week</p>
                  </div>
                </div>
              </div>
              <div class="mt-4 text-center">
                <button
                  class="text-blue-400 hover:text-blue-300 text-sm font-medium"
                >
                  View Full Leaderboard →
                </button>
              </div>
            </div>

            <!-- Payment Section -->
            <div class="dashboard-card glass">
              <h2 class="text-2xl font-bold mb-4">Your Earnings</h2>
              <div class="flex items-center justify-between mb-6">
                <div>
                  <p class="text-sm text-gray-500 dark:text-gray-400">
                    Total Unpaid Balance
                  </p>
                  <p
                    id="totalEarnings"
                    class="text-4xl font-bold text-green-600 dark:text-green-400"
                  >
                    US$0.00
                  </p>
                </div>
                <button id="requestPaymentBtn" class="btn-primary">
                  Request Payment
                </button>
              </div>

              <div>
                <div class="flex justify-between items-center mb-4">
                  <h3 class="text-xl font-bold">Payment Logs</h3>
                  <span class="text-sm text-blue-400">Recent Transactions</span>
                </div>
                <div class="overflow-x-auto">
                  <table class="min-w-full divide-y divide-gray-700">
                    <thead>
                      <tr
                        class="text-left text-xs font-semibold uppercase tracking-wider text-gray-400"
                      >
                        <th class="py-3 px-4">Date</th>
                        <th class="py-3 px-4">Amount</th>
                        <th class="py-3 px-4">Status</th>
                        <th class="py-3 px-4">Type</th>
                        <th class="py-3 px-4 text-right">Action</th>
                      </tr>
                    </thead>
                    <tbody
                      id="paymentLogTableBody"
                      class="divide-y divide-gray-800"
                    >
                      <tr class="hover:bg-gray-800/50">
                        <td class="py-3 px-4 text-sm text-gray-300">
                          2025-08-28
                        </td>
                        <td
                          class="py-3 px-4 text-sm font-medium text-green-400"
                        >
                          $1,200.00
                        </td>
                        <td class="py-3 px-4">
                          <span
                            class="px-2 py-1 text-xs font-medium rounded-full bg-green-900/30 text-green-400"
                          >
                            Completed
                          </span>
                        </td>
                        <td class="py-3 px-4 text-sm text-gray-400">
                          Withdrawal
                        </td>
                        <td class="py-3 px-4 text-right">
                          <a
                            href="transaction-details.html"
                            class="text-blue-400 hover:text-blue-300 text-sm"
                            >View</a
                          >
                        </td>
                      </tr>
                      <tr class="hover:bg-gray-800/50">
                        <td class="py-3 px-4 text-sm text-gray-300">
                          2025-08-21
                        </td>
                        <td
                          class="py-3 px-4 text-sm font-medium text-green-400"
                        >
                          $850.00
                        </td>
                        <td class="py-3 px-4">
                          <span
                            class="px-2 py-1 text-xs font-medium rounded-full bg-green-900/30 text-green-400"
                          >
                            Completed
                          </span>
                        </td>
                        <td class="py-3 px-4 text-sm text-gray-400">
                          Withdrawal
                        </td>
                        <td class="py-3 px-4 text-right">
                          <a
                            href="transaction-details.html"
                            class="text-blue-400 hover:text-blue-300 text-sm"
                            >View</a
                          >
                        </td>
                      </tr>
                      <tr class="hover:bg-gray-800/50">
                        <td class="py-3 px-4 text-sm text-gray-300">
                          2025-08-14
                        </td>
                        <td
                          class="py-3 px-4 text-sm font-medium text-yellow-400"
                        >
                          $1,500.00
                        </td>
                        <td class="py-3 px-4">
                          <span
                            class="px-2 py-1 text-xs font-medium rounded-full bg-yellow-900/30 text-yellow-400"
                          >
                            Pending
                          </span>
                        </td>
                        <td class="py-3 px-4 text-sm text-gray-400">
                          Withdrawal
                        </td>
                        <td class="py-3 px-4 text-right">
                          <a
                            href="transaction-details.html"
                            class="text-blue-400 hover:text-blue-300 text-sm"
                            >View</a
                          >
                        </td>
                      </tr>
                    </tbody>
                  </table>
                  <div class="mt-4 text-center">
                    <a
                      href="transactions.html"
                      class="text-blue-400 hover:text-blue-300 text-sm font-medium"
                      >View All Transactions →</a
                    >
                  </div>
                </div>
              </div>
            </div>

            <!-- Team Leaderboard -->
            <div class="dashboard-card glass">
              <div class="flex justify-between items-center mb-4">
                <div>
                  <h2 class="text-2xl font-bold">Team Leaderboard</h2>
                  <p class="text-sm text-gray-400">
                    Top performing teams this week
                  </p>
                </div>
                <div class="text-right">
                  <div class="text-blue-400 text-sm">
                    <i class="fas fa-sync-alt mr-1"></i>
                    <span>Updated 5 min ago</span>
                  </div>
                  <div class="text-xs text-gray-500">
                    <span class="text-green-400">▲ 2.5%</span> from last week
                  </div>
                </div>
              </div>

              <!-- Team Rankings Table -->
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-700">
                  <thead>
                    <tr>
                      <th
                        class="px-4 py-3 text-left text-xs text-gray-400 uppercase"
                      >
                        Rank
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs text-gray-400 uppercase"
                      >
                        Team
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs text-gray-400 uppercase"
                      >
                        Points
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs text-gray-400 uppercase"
                      >
                        Companies Referred
                      </th>
                      <th
                        class="px-4 py-3 text-left text-xs text-gray-400 uppercase"
                      >
                        Weekly Change
                      </th>
                    </tr>
                  </thead>
                  <tbody class="divide-y divide-gray-800">
                    <!-- Team 1 -->
                    <tr class="hover:bg-gray-800/50">
                      <td class="px-4 py-3">
                        <div
                          class="w-8 h-8 rounded-full bg-yellow-500 flex items-center justify-center text-yellow-100 font-bold text-sm"
                        >
                          1
                        </div>
                      </td>
                      <td class="px-4 py-3">
                        <div class="flex items-center">
                          <div
                            class="h-10 w-10 rounded-full bg-yellow-600 flex items-center justify-center text-yellow-100 font-bold text-lg"
                          >
                            AW
                          </div>
                          <div class="ml-3">
                            <div class="font-medium">Aqua Warriors</div>
                            <div class="text-xs text-gray-400">3 members</div>
                          </div>
                        </div>
                      </td>
                      <td class="px-4 py-3 font-bold">24,500</td>
                      <td class="px-4 py-3">
                        <div class="flex items-center">
                          <div
                            class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm font-medium"
                          >
                            12
                          </div>
                        </div>
                      </td>
                      <td class="px-4 py-3 text-green-400">▲ +1,250 (5.4%)</td>
                    </tr>

                    <!-- Team 2 -->
                    <tr class="hover:bg-gray-800/50">
                      <td class="px-4 py-3">
                        <div
                          class="w-8 h-8 rounded-full bg-gray-400 flex items-center justify-center text-gray-100 font-bold text-sm"
                        >
                          2
                        </div>
                      </td>
                      <td class="px-4 py-3">
                        <div class="flex items-center">
                          <div
                            class="h-10 w-10 rounded-full bg-gray-500 flex items-center justify-center text-gray-100 font-bold text-lg"
                          >
                            TW
                          </div>
                          <div class="ml-3">
                            <div class="font-medium">Tech Wizards</div>
                            <div class="text-xs text-gray-400">5 members</div>
                          </div>
                        </div>
                      </td>
                      <td class="px-4 py-3 font-bold">21,300</td>
                      <td class="px-4 py-3">
                        <div class="flex items-center">
                          <div
                            class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm font-medium"
                          >
                            9
                          </div>
                        </div>
                      </td>
                      <td class="px-4 py-3 text-green-400">▲ +980 (4.8%)</td>
                    </tr>

                    <!-- Team 3 -->
                    <tr class="hover:bg-gray-800/50">
                      <td class="px-4 py-3">
                        <div
                          class="w-8 h-8 rounded-full bg-amber-700 flex items-center justify-center text-amber-100 font-bold text-sm"
                        >
                          3
                        </div>
                      </td>
                      <td class="px-4 py-3">
                        <div class="flex items-center">
                          <div
                            class="h-10 w-10 rounded-full bg-amber-600 flex items-center justify-center text-amber-100 font-bold text-lg"
                          >
                            DS
                          </div>
                          <div class="ml-3">
                            <div class="font-medium">Digital Sharks</div>
                            <div class="text-xs text-gray-400">4 members</div>
                          </div>
                        </div>
                      </td>
                      <td class="px-4 py-3 font-bold">19,750</td>
                      <td class="px-4 py-3">
                        <div class="flex items-center">
                          <div
                            class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm font-medium"
                          >
                            7
                          </div>
                        </div>
                      </td>
                      <td class="px-4 py-3 text-green-400">▲ +1,120 (6.0%)</td>
                    </tr>

                    <!-- Team 4 (Your Team) -->
                    <tr class="hover:bg-gray-800/50 bg-blue-900/10">
                      <td class="px-4 py-3">
                        <div
                          class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-blue-100 font-bold text-sm"
                        >
                          4
                        </div>
                      </td>
                      <td class="px-4 py-3">
                        <div class="flex items-center">
                          <div
                            class="h-10 w-10 rounded-full bg-blue-700 flex items-center justify-center text-blue-100 font-bold text-lg"
                          >
                            YT
                          </div>
                          <div class="ml-3">
                            <div class="font-medium flex items-center">
                              Your Team
                              <span
                                class="ml-2 text-xs bg-blue-900/50 text-blue-300 px-2 py-0.5 rounded-full"
                                >You</span
                              >
                            </div>
                            <div class="text-xs text-gray-400">3 members</div>
                          </div>
                        </div>
                      </td>
                      <td class="px-4 py-3 font-bold text-blue-300">18,750</td>
                      <td class="px-4 py-3">
                        <div class="flex items-center">
                          <div
                            class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm font-medium"
                          >
                            6
                          </div>
                        </div>
                      </td>
                      <td class="px-4 py-3 text-green-400">▲ +890 (5.0%)</td>
                    </tr>

                    <!-- Team 5 -->
                    <tr class="hover:bg-gray-800/50">
                      <td class="px-4 py-3">
                        <div
                          class="w-8 h-8 rounded-full flex items-center justify-center text-gray-100 font-bold text-sm"
                        >
                          5
                        </div>
                      </td>
                      <td class="px-4 py-3">
                        <div class="flex items-center">
                          <div
                            class="h-10 w-10 rounded-full bg-purple-500 flex items-center justify-center text-purple-100 font-bold text-lg"
                          >
                            QP
                          </div>
                          <div class="ml-3">
                            <div class="font-medium">Quantum Pioneers</div>
                            <div class="text-xs text-gray-400">6 members</div>
                          </div>
                        </div>
                      </td>
                      <td class="px-4 py-3 font-bold">16,800</td>
                      <td class="px-4 py-3">
                        <div class="flex items-center">
                          <div
                            class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white text-sm font-medium"
                          >
                            5
                          </div>
                        </div>
                      </td>
                      <td class="px-4 py-3 text-green-400">▲ +720 (4.5%)</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- View All Teams Button -->
              <div class="mt-4 pt-4 border-t border-gray-700/50">
                <a
                  href="leaderboard.html"
                  class="w-full flex items-center justify-between text-blue-400 hover:text-blue-300 transition-colors group"
                >
                  <span>View full leaderboard</span>
                  <i
                    class="fas fa-arrow-right group-hover:translate-x-1 transition-transform"
                  ></i>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Referral Program View (Initially Hidden) -->
      <div id="referral-view" class="hidden max-w-4xl mx-auto">
        <div class="text-center mb-8">
          <h1 class="text-3xl font-bold mb-2">Phluowise Referral Program</h1>
          <p class="text-gray-400">
            Earn 20% commission for every client you refer
          </p>
        </div>

        <!-- Referral Card -->
        <div class="dashboard-card glass mb-8">
          <div class="referral-gradient-bg rounded-2xl p-6 text-center mb-8">
            <h2 class="text-2xl font-bold mb-4">
              Refer your first client now and earn a 20% commission
            </h2>
            <p class="text-lg mb-6">They'll get a 20% discount too.</p>

            <div class="bg-white/10 p-4 rounded-xl mb-6">
              <div
                class="flex items-center justify-between bg-gray-900 rounded-lg p-3 mb-2"
              >
                <code
                  class="text-lg font-mono overflow-x-auto whitespace-nowrap"
                  id="referralLink"
                  >https://hostinger.com?REFERRALCODE=i8RPHLUOWGQM</code
                >
              </div>
              <button
                id="copyButton"
                class="btn-primary text-white font-semibold py-3 px-6 rounded-lg w-full"
              >
                <i class="far fa-copy mr-2"></i> Copy referral link
              </button>
            </div>

            <div class="flex justify-center space-x-4">
              <button
                class="bg-white/20 hover:bg-white/30 text-white py-2 px-4 rounded-lg transition"
              >
                <i class="fab fa-twitter mr-2"></i> Twitter
              </button>
              <button
                class="bg-white/20 hover:bg-white/30 text-white py-2 px-4 rounded-lg transition"
              >
                <i class="fab fa-facebook mr-2"></i> Facebook
              </button>
              <button
                class="bg-white/20 hover:bg-white/30 text-white py-2 px-4 rounded-lg transition"
              >
                <i class="fab fa-linkedin mr-2"></i> LinkedIn
              </button>
              <button
                class="bg-white/20 hover:bg-white/30 text-white py-2 px-4 rounded-lg transition"
              >
                <i class="fab fa-whatsapp mr-2"></i> WhatsApp
              </button>
            </div>
          </div>

          <!-- Stats -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-gray-800 p-4 rounded-xl text-center">
              <p class="text-3xl font-bold text-blue-400">$0</p>
              <p class="text-gray-400">Total Earnings</p>
            </div>
            <div class="bg-gray-800 p-4 rounded-xl text-center">
              <p class="text-3xl font-bold text-green-400">0</p>
              <p class="text-gray-400">Successful Referrals</p>
            </div>
            <div class="bg-gray-800 p-4 rounded-xl text-center">
              <p class="text-3xl font-bold text-purple-400">0</p>
              <p class="text-gray-400">Pending Referrals</p>
            </div>
          </div>

          <!-- Referral Log -->
          <div>
            <h3 class="text-xl font-semibold mb-4">Your Referral Activity</h3>
            <div class="bg-gray-800/30 rounded-xl overflow-hidden">
              <table class="w-full referral-table">
                <thead>
                  <tr>
                    <th class="text-left py-4 px-6">Company</th>
                    <th class="text-left py-4 px-6">Date Referred</th>
                    <th class="text-left py-4 px-6">Status</th>
                    <th class="text-right py-4 px-6">Commission</th>
                  </tr>
                </thead>
                <tbody id="referralLog">
                  <tr>
                    <td colspan="4" class="text-center py-8 text-gray-500">
                      No referrals yet. Your referral activity will appear here.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- How it works -->
        <div class="dashboard-card glass">
          <h3 class="text-xl font-semibold mb-4">How it works</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-gray-800/30 p-4 rounded-xl">
              <div
                class="w-12 h-12 rounded-full bg-blue-500 flex items-center justify-center text-white mb-4"
              >
                <span class="text-xl font-bold">1</span>
              </div>
              <h4 class="font-semibold mb-2">Share your link</h4>
              <p class="text-gray-400">
                Share your unique referral link with businesses
              </p>
            </div>
            <div class="bg-gray-800/30 p-4 rounded-xl">
              <div
                class="w-12 h-12 rounded-full bg-blue-500 flex items-center justify-center text-white mb-4"
              >
                <span class="text-xl font-bold">2</span>
              </div>
              <h4 class="font-semibold mb-2">They sign up</h4>
              <p class="text-gray-400">
                Businesses sign up using your referral link
              </p>
            </div>
            <div class="bg-gray-800/30 p-4 rounded-xl">
              <div
                class="w-12 h-12 rounded-full bg-blue-500 flex items-center justify-center text-white mb-4"
              >
                <span class="text-xl font-bold">3</span>
              </div>
              <h4 class="font-semibold mb-2">Earn commission</h4>
              <p class="text-gray-400">
                Earn 20% commission on their first purchase
              </p>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Modal for messages and confirmation -->
    <div
      id="modal"
      class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center p-4 z-50"
    >
      <div
        class="bg-white dark:bg-gray-800 rounded-xl p-8 max-w-sm w-full shadow-xl"
      >
        <h3 id="modalTitle" class="text-lg font-bold mb-4"></h3>
        <p id="modalMessage" class="text-gray-600 dark:text-gray-300 mb-6"></p>
        <div class="flex justify-end space-x-4">
          <button
            id="modalCloseBtn"
            class="btn-secondary dark:bg-gray-700 dark:text-white"
          >
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Add Chart.js for the earnings graph -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      // Initialize the application when the DOM is fully loaded
      document.addEventListener('DOMContentLoaded', function() {
        try {
          // Initialize navigation and authentication
          Navigation.init();
          
          // Check authentication status
          const currentUser = Auth.getCurrentUser();
          
          if (!currentUser) {
            // Redirect to signin if not authenticated
            window.location.href = 'signin.html';
            return;
          }
          
          // Update last login time
          const users = JSON.parse(localStorage.getItem(DataModel.users) || '[]');
          const userIndex = users.findIndex(u => u.id === currentUser.id);
          
          if (userIndex !== -1) {
            users[userIndex].lastLogin = new Date().toISOString();
            localStorage.setItem(DataModel.users, JSON.stringify(users));
          }
          
          // Load user data and initialize components
          loadUserData(currentUser);
          initializeEarningsChart(currentUser.id);
          setupEventListeners();
          setupNavigation();
          setupReferralFunctionality();
          
          // Update UI with user data
          updateUserInfo(currentUser);
          updateUserStats(currentUser);
          loadUserPayments(currentUser.id);
          loadUserReferrals(currentUser.id);
          
        } catch (error) {
          console.error('Error initializing application:', error);
          showModal('Error', 'Failed to initialize application. Please try again.');
        }
      });

      // Load and update user data in the UI
      function updateUserInfo(user) {
        if (!user) return;

        try {
          // Update user greeting and basic info
          const userName = document.getElementById('userName');
          const userEmail = document.getElementById('userEmail');
          const userPoints = document.getElementById('userPoints');
          const userRank = document.getElementById('userRank');
          const welcomeMessage = document.getElementById('welcomeMessage');
          const userAvatar = document.getElementById('userAvatar');
          const userSince = document.getElementById('userSince');
          
          // Format user name
          if (userName) {
            const name = user.firstName || user.email.split('@')[0];
            userName.textContent = name.charAt(0).toUpperCase() + name.slice(1);
          }
          
          // Update user details
          if (userEmail) userEmail.textContent = user.email || '';
          if (userPoints) userPoints.textContent = user.balance?.toFixed(2) || '0.00';
          if (userRank) userRank.textContent = `#${user.rank || 'N/A'}`;
          
          // Update welcome message
          if (welcomeMessage) {
            const name = user.firstName || 'there';
            welcomeMessage.textContent = `Welcome back, ${name}!`;
          }
          
          // Update avatar with initials if no image
          if (userAvatar) {
            if (!user.avatar) {
              const initials = (user.firstName?.charAt(0) || '') + (user.lastName?.charAt(0) || '');
              userAvatar.textContent = initials || user.email?.charAt(0).toUpperCase() || 'U';
              userAvatar.classList.remove('hidden');
            } else {
              userAvatar.style.backgroundImage = `url(${user.avatar})`;
              userAvatar.textContent = '';
            }
          }
          
          // Update member since date
          if (userSince && user.createdAt) {
            const joinDate = new Date(user.createdAt);
            userSince.textContent = `Member since ${joinDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}`;
          }

          // Update team information if available
          const teams = TeamService.getUserTeams(user.id);
          const teamManagementSection = document.getElementById('teamManagementSection');
          const memberList = document.getElementById('memberList');
          const memberCount = document.getElementById('memberCount');
          
          if (teamManagementSection && memberList && memberCount) {
            if (teams?.length > 0) {
              const team = teams[0]; // Assuming user is part of one team for now
              teamManagementSection.classList.remove('hidden');
              
              // Update team members count
              const members = team.members || [];
              memberCount.textContent = `${members.length} ${members.length === 1 ? 'Member' : 'Members'}`;
              
              // Clear existing member list
              memberList.innerHTML = '';
              
              // Add team members to the list
              members.forEach(member => {
                const memberItem = document.createElement('li');
                memberItem.className = 'flex justify-between items-center py-2 border-b border-gray-700';
                memberItem.innerHTML = `
                  <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center text-sm font-medium">
                      ${member.name?.charAt(0) || 'U'}
                    </div>
                    <span>${member.name || 'Team Member'}</span>
                  </div>
                  <span class="text-sm text-gray-400">${member.role || 'Member'}</span>
                `;
                memberList.appendChild(memberItem);
              });
            } else {
              teamManagementSection.classList.add('hidden');
            }
          }
        } catch (error) {
          console.error('Error updating user info:', error);
        }
      }

      // Initialize earnings chart with user data
      function initializeEarningsChart(userId) {
        const ctx = document.getElementById('earningsChart');
        if (!ctx) return;

        try {
          // Get user's payment history
          const payments = PaymentService.getUserPayments(userId) || [];
          
          // Group payments by day for the last 7 days
          const last7Days = Array(7).fill(0).map((_, i) => {
            const date = new Date();
            date.setDate(date.getDate() - (6 - i));
            return date.toISOString().split('T')[0];
          });

          const earningsByDay = last7Days.map(date => {
            return payments
              .filter(p => p.date.startsWith(date))
              .reduce((sum, p) => sum + (p.amount || 0), 0);
          });

          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: last7Days.map(date => {
                const d = new Date(date);
                return ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'][d.getDay()];
              }),
              datasets: [{
                label: 'Earnings ($)',
                data: earningsByDay,
                backgroundColor: 'rgba(59, 130, 246, 0.7)',
                borderColor: 'rgba(59, 130, 246, 1)',
                borderWidth: 1,
                borderRadius: 6,
                barThickness: 12
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: false },
                tooltip: {
                  callbacks: {
                    label: function(context) {
                      return `$${context.raw.toFixed(2)}`;
                    }
                  }
                }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  grid: { color: 'rgba(255, 255, 255, 0.1)' },
                  ticks: {
                    color: '#9CA3AF',
                    callback: value => `$${value}`
                  }
                },
                x: {
                  grid: { display: false },
                  ticks: { color: '#9CA3AF' }
                }
              }
            }
          });
        } catch (error) {
          console.error('Error initializing earnings chart:', error);
        }
      }

      // Update user stats in the UI
      function updateUserStats(user) {
        if (!user) return;

        // Get user's payment data
        const totalEarnings = PaymentService.getTotalEarnings(user.id) || 0;
        const monthlyEarnings = PaymentService.getMonthlyEarnings(user.id) || 0;
        const nextPayout = PaymentService.getNextPayout(user.id);
        
        // Update stats cards
        const totalEarningsEl = document.getElementById('totalEarnings');
        const monthlyEarningsEl = document.getElementById('monthlyEarnings');
        const referralEarningsEl = document.getElementById('referralEarnings');
        const referralCountEl = document.getElementById('referralCount');
        const nextPayoutEl = document.getElementById('nextPayout');
        const availableBalanceEl = document.getElementById('availableBalance');
        
        if (totalEarningsEl) totalEarningsEl.textContent = `$${totalEarnings.toFixed(2)}`;
        if (monthlyEarningsEl) monthlyEarningsEl.textContent = `+$${monthlyEarnings.toFixed(2)}`;
        if (referralEarningsEl) referralEarningsEl.textContent = `$${(user.referralEarnings || 0).toFixed(2)}`;
        if (referralCountEl) referralCountEl.textContent = user.referralCount || 0;
        if (nextPayoutEl) nextPayoutEl.textContent = nextPayout ? `$${nextPayout.amount.toFixed(2)}` : '$0.00';
        if (availableBalanceEl) availableBalanceEl.textContent = `$${(user.balance || 0).toFixed(2)}`;
        
        // Update payout date if available
        const payoutDateEl = document.getElementById('payoutDate');
        if (payoutDateEl) {
          payoutDateEl.textContent = nextPayout?.date ? 
            new Date(nextPayout.date).toLocaleDateString() : 'No pending payouts';
        }
      }

      // Load and display user's payment history
      function loadUserPayments(userId) {
        const paymentLog = document.getElementById('recentTransactions');
        if (!paymentLog) return;
        
        const payments = PaymentService.getUserPayments(userId) || [];
        const recentPayments = payments
          .sort((a, b) => new Date(b.date) - new Date(a.date))
          .slice(0, 5); // Show only 5 most recent
        
        if (recentPayments.length === 0) {
          paymentLog.innerHTML = `
            <div class="flex items-center justify-center py-8">
              <div class="text-center text-gray-500">
                <i class="fas fa-exchange-alt text-2xl mb-2"></i>
                <p>No transactions yet</p>
              </div>
            </div>
          `;
          return;
        }
        
        paymentLog.innerHTML = recentPayments.map(payment => `
          <div class="flex items-center justify-between py-3 border-b border-gray-800 last:border-0">
            <div class="flex items-center">
              <div class="w-10 h-10 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-400 mr-3">
                <i class="fas ${payment.type === 'withdrawal' ? 'fa-arrow-up' : 'fa-arrow-down'}"></i>
              </div>
              <div>
                <p class="text-sm font-medium">${payment.description || 'Payment'}</p>
                <p class="text-xs text-gray-400">${new Date(payment.date).toLocaleDateString()}</p>
              </div>
            </div>
            <div class="text-right">
              <p class="text-sm font-medium ${payment.amount >= 0 ? 'text-green-400' : 'text-red-400'}">
                ${payment.amount >= 0 ? '+' : ''}${payment.amount.toFixed(2)}
              </p>
              <span class="text-xs px-2 py-1 rounded-full ${getStatusBadgeClass(payment.status)}">
                ${payment.status.charAt(0).toUpperCase() + payment.status.slice(1)}
              </span>
            </div>
          </div>
        `).join('');
      }
      
      // Helper function to get status badge class
      function getStatusBadgeClass(status) {
        const statusClasses = {
          completed: 'bg-green-900/30 text-green-400',
          pending: 'bg-yellow-900/30 text-yellow-400',
          failed: 'bg-red-900/30 text-red-400',
          processing: 'bg-blue-900/30 text-blue-400'
        };
        return statusClasses[status.toLowerCase()] || 'bg-gray-700/30 text-gray-400';
      }

      function setupEventListeners() {
        const user = Auth.getCurrentUser();
        if (!user) return;

        // Mobile menu toggle
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const sidebarNav = document.getElementById('sidebar-nav');
        
        if (mobileMenuToggle && sidebarNav) {
          mobileMenuToggle.addEventListener('click', () => {
            sidebarNav.classList.toggle('-translate-x-full');
          });
        }

        // Desktop menu toggle
        const desktopMenuToggle = document.getElementById('desktopMenuToggle');
        if (desktopMenuToggle && sidebarNav) {
          desktopMenuToggle.addEventListener('click', () => {
            sidebarNav.classList.toggle('-translate-x-full');
          });
        }

        // Sign out button
        const signOutBtn = document.getElementById('signOutBtn');
        if (signOutBtn) {
          signOutBtn.addEventListener('click', () => {
            Swal.fire({
              title: 'Sign Out',
              text: 'Are you sure you want to sign out?',
              icon: 'question',
              showCancelButton: true,
              confirmButtonColor: '#3b82f6',
              cancelButtonColor: '#6b7280',
              confirmButtonText: 'Yes, sign out'
            }).then((result) => {
              if (result.isConfirmed) {
                Auth.logout();
                window.location.href = 'signin.html';
              }
            });
          });
        }

        // Withdrawal button
        const withdrawBtn = document.getElementById('withdrawBtn');
        if (withdrawBtn) {
          withdrawBtn.addEventListener('click', () => {
            if (user.balance <= 0) {
              showModal('Insufficient Balance', 'You do not have any available balance to withdraw.');
              return;
            }
            
            Swal.fire({
              title: 'Request Withdrawal',
              html: `
                <div class="text-left">
                  <div class="mb-4">
                    <label class="block text-gray-300 text-sm font-medium mb-2">Amount</label>
                    <div class="relative">
                      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <span class="text-gray-400">$</span>
                      </div>
                      <input type="number" id="withdrawalAmount" 
                        class="bg-gray-800 border border-gray-700 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full pl-8 p-2.5" 
                        placeholder="0.00" 
                        min="10" 
                        max="${user.balance}" 
                        step="0.01" 
                        required>
                    </div>
                    <p class="text-xs text-gray-400 mt-1">Available: $${user.balance?.toFixed(2) || '0.00'}</p>
                  </div>
                  <div class="mb-4">
                    <label class="block text-gray-300 text-sm font-medium mb-2">Payment Method</label>
                    <select id="paymentMethod" class="bg-gray-800 border border-gray-700 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">
                      <option value="paypal">PayPal</option>
                      <option value="bank">Bank Transfer</option>
                      <option value="crypto">Cryptocurrency</option>
                    </select>
                  </div>
                </div>
              `,
              showCancelButton: true,
              confirmButtonText: 'Request Withdrawal',
              confirmButtonColor: '#3b82f6',
              cancelButtonText: 'Cancel',
              cancelButtonColor: '#6b7280',
              focusConfirm: false,
              preConfirm: () => {
                const amount = parseFloat(document.getElementById('withdrawalAmount').value);
                const method = document.getElementById('paymentMethod').value;
                
                if (!amount || amount < 10) {
                  Swal.showValidationMessage('Minimum withdrawal amount is $10');
                  return false;
                }
                
                if (amount > user.balance) {
                  Swal.showValidationMessage('Amount exceeds available balance');
                  return false;
                }
                
                return { amount, method };
              }
            }).then((result) => {
              if (result.isConfirmed) {
                const { amount, method } = result.value;
                
                // Process withdrawal
                PaymentService.requestWithdrawal(user.id, amount, method)
                  .then(() => {
                    Swal.fire(
                      'Success!',
                      `Your withdrawal request of $${amount.toFixed(2)} has been submitted.`,
                      'success'
                    ).then(() => {
                      // Refresh the page to update balances
                      window.location.reload();
                    });
                  })
                  .catch(error => {
                    console.error('Withdrawal error:', error);
                    Swal.fire(
                      'Error',
                      'Failed to process withdrawal. Please try again later.',
                      'error'
                    );
                  });
              }
            });
          });
        }

        // Documentation link
        const docsLink = document.getElementById('docsLink');
        if (docsLink) {
          docsLink.addEventListener('click', (e) => {
            e.preventDefault();
            showModal('Documentation', 'Documentation will be available soon!');
          });
        }

        // Referral navigation link
        const referralNavLink = document.getElementById('referralNavLink');
        if (referralNavLink) {
          referralNavLink.addEventListener('click', (e) => {
            e.preventDefault();
            showReferralView();
          });
        }
      }

      function setupNavigation() {
        // Add active class to current page in navigation
        const currentPage = window.location.pathname.split("/").pop();
        const navLinks = document.querySelectorAll("#sidebar-nav a");
        navLinks.forEach((link) => {
          const href = link.getAttribute("href");
          if (href === currentPage) {
            link.classList.add("bg-gray-800", "text-blue-400");
            link.classList.remove("text-gray-200", "hover:text-blue-400");
          }
        });
      }
      
      // Load and display user's referral activity
      function loadUserReferrals(userId) {
        const referralLog = document.getElementById('referralLog');
        if (!referralLog) return;
        
        const referrals = ReferralService.getUserReferrals(userId) || [];
        
        if (referrals.length === 0) {
          referralLog.innerHTML = `
            <tr>
              <td colspan="4" class="py-8 text-center text-gray-500">
                <i class="fas fa-users-slash text-2xl mb-2 block"></i>
                No referrals yet. Share your link to start earning!
              </td>
            </tr>
          `;
          return;
        }
        
        // Sort by date (newest first)
        const sortedReferrals = [...referrals].sort((a, b) => 
          new Date(b.createdAt) - new Date(a.createdAt)
        );
        
        referralLog.innerHTML = sortedReferrals.map(ref => `
          <tr class="border-t border-gray-700/50 hover:bg-gray-800/30">
            <td class="py-4 px-6">
              <div class="flex items-center">
                <div class="w-8 h-8 rounded-full bg-blue-500/10 flex items-center justify-center text-blue-400 mr-3">
                  <i class="fas fa-user-plus"></i>
                </div>
                <div>
                  <p class="font-medium">${ref.referredEmail || 'New User'}</p>
                  <p class="text-xs text-gray-400">${new Date(ref.createdAt).toLocaleDateString()}</p>
                </div>
              </div>
            </td>
            <td class="py-4 px-6">
              <span class="px-2 py-1 text-xs rounded-full ${getStatusBadgeClass(ref.status)}">
                ${ref.status.charAt(0).toUpperCase() + ref.status.slice(1)}
              </span>
            </td>
            <td class="py-4 px-6 text-right font-medium">
              $${(ref.commission || 0).toFixed(2)}
            </td>
          </tr>
        `).join('');
      }

        // Show referral view
        const referralView = document.getElementById("referral-view");
        if (referralView) {
          referralView.classList.remove("hidden");
        }

        // Update navigation active states
        const sidebarLinks = document.querySelectorAll("#sidebar-nav a");
        sidebarLinks.forEach((link) => {
          link.classList.remove("bg-gray-800", "text-blue-400");
          link.classList.add("text-gray-200", "hover:text-blue-400");
        });

        // Set referral link as active
        const referralNavLink = document.getElementById("referralNavLink");
        if (referralNavLink) {
          referralNavLink.classList.add("bg-gray-800", "text-blue-400");
          referralNavLink.classList.remove(
            "text-gray-200",
            "hover:text-blue-400"
          );
        }
      }

      function showModal(title, message) {
        const modal = document.getElementById("modal");
        const modalTitle = document.getElementById("modalTitle");
        const modalMessage = document.getElementById("modalMessage");
        const modalCloseBtn = document.getElementById("modalCloseBtn");

        if (modal && modalTitle && modalMessage) {
          modalTitle.textContent = title;
          modalMessage.textContent = message;
          modal.classList.remove("hidden");

          if (modalCloseBtn) {
            modalCloseBtn.addEventListener("click", function () {
              modal.classList.add("hidden");
            });
          }
        }
      }
    </script>
  </body>
</html>
